import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.a7175731.js";const u=JSON.parse('{"title":"Python爬虫 --笔记","description":"","frontmatter":{},"headers":[],"relativePath":"python/python爬虫/BeautifulSoup案例.md","filePath":"python/python爬虫/BeautifulSoup案例.md","lastUpdated":null}'),p={name:"python/python爬虫/BeautifulSoup案例.md"},o=l(`<h1 id="python爬虫-笔记" tabindex="-1">Python爬虫 --笔记 <a class="header-anchor" href="#python爬虫-笔记" aria-label="Permalink to &quot;Python爬虫 --笔记&quot;">​</a></h1><h2 id="依赖库" tabindex="-1">依赖库 <a class="header-anchor" href="#依赖库" aria-label="Permalink to &quot;依赖库&quot;">​</a></h2><ul><li>request（请求网页）</li><li>re</li><li>json</li><li>BeautifulSoup</li><li>tqdm（进度条）</li></ul><h2 id="个人笔记" tabindex="-1">个人笔记 <a class="header-anchor" href="#个人笔记" aria-label="Permalink to &quot;个人笔记&quot;">​</a></h2><ul><li>见云盘</li></ul><h2 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-label="Permalink to &quot;实例&quot;">​</a></h2><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> requests</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> re</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> json</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> bs4 </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> BeautifulSoup</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> tqdm </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> tqdm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CoronaVirusSpider</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">object</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#load、save、get_content_from_url、parse_corona_virus是工具函数，都会用到，所以都放到上边</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__init__</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.home_url </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;https://ncov.dxy.cn/ncovh5/view/pneumonia&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(self,path):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(path,</span><span style="color:#FFAB70;">encoding</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> fp:</span></span>
<span class="line"><span style="color:#E1E4E8;">            data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> json.load(fp)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">(self,data,path):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(path,</span><span style="color:#9ECBFF;">&#39;w&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">encoding</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> fp:</span></span>
<span class="line"><span style="color:#E1E4E8;">            json.dump(data,fp,</span><span style="color:#FFAB70;">ensure_ascii</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">get_content_from_url</span><span style="color:#E1E4E8;">(self,url):</span></span>
<span class="line"><span style="color:#E1E4E8;">        response </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> requests.get(url)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> response.content.decode()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parse_corona_virus</span><span style="color:#E1E4E8;">(self,last_day_corona_virus_of_china,desc):</span></span>
<span class="line"><span style="color:#E1E4E8;">        corona_virus </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> country </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> tqdm(last_day_corona_virus_of_china,desc):</span></span>
<span class="line"><span style="color:#E1E4E8;">            statistics_data_url </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> country[</span><span style="color:#9ECBFF;">&#39;statisticsData&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">            statistics_data_json_str </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.get_content_from_url(statistics_data_url)</span></span>
<span class="line"><span style="color:#E1E4E8;">            statistics_data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> json.loads(statistics_data_json_str)[</span><span style="color:#9ECBFF;">&#39;data&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> one_day </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> statistics_data:</span></span>
<span class="line"><span style="color:#E1E4E8;">                one_day[</span><span style="color:#9ECBFF;">&#39;provinceName&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> country[</span><span style="color:#9ECBFF;">&#39;provinceName&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> country.get(</span><span style="color:#9ECBFF;">&#39;countryShortCode&#39;</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">                    one_day[</span><span style="color:#9ECBFF;">&#39;countryShortCode&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> country[</span><span style="color:#9ECBFF;">&#39;countryShortCode&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">            corona_virus.extend(statistics_data)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> corona_virus</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#parse_home_page、crawl_last_day_corona_virus这两个函数是提取爬取好全国数据，之后放到文件中提供给</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#crawl_corona_virus、parse_corona_virus函数用于读取和解析全球疫情数据</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parse_home_page</span><span style="color:#E1E4E8;">(self,home_page,tag_id):</span></span>
<span class="line"><span style="color:#E1E4E8;">        soup </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> BeautifulSoup(home_page,</span><span style="color:#9ECBFF;">&#39;lxml&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        script </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> soup.find(</span><span style="color:#FFAB70;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> tag_id)</span></span>
<span class="line"><span style="color:#E1E4E8;">        json_str </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> re.findall(</span><span style="color:#F97583;">r</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#85E89D;font-weight:bold;">\\[</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">+</span><span style="color:#85E89D;font-weight:bold;">\\]</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">(script))[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> json.loads(json_str)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">crawl_last_day_corona_virus</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">        home_page </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.get_content_from_url(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.home_url)</span></span>
<span class="line"><span style="color:#E1E4E8;">        last_day_corona_virus </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.parse_home_page(home_page,</span><span style="color:#FFAB70;">tag_id</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;getListByCountryTypeService2true&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.save(last_day_corona_virus,</span><span style="color:#9ECBFF;">&#39;last_day_corona_virus.json&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">crawl_corona_virus</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">        last_day_corona_virus </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.load(</span><span style="color:#9ECBFF;">&#39;last_day_corona_virus.json&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        corona_virus </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.parse_corona_virus(last_day_corona_virus,</span><span style="color:#FFAB70;">desc</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;采集1月25以来各国疫情数据&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.save(corona_virus,</span><span style="color:#9ECBFF;">&#39;corona_virus.json&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#crawl_last_corona_virus_of_china提前爬取好全国数据，</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#供crawl_corona_virus_of_china、parse_corona_virus函数读取和解析使用</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">crawl_last_corona_virus_of_china</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">        home_page </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.get_content_from_url(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.home_url)</span></span>
<span class="line"><span style="color:#E1E4E8;">        soup </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> BeautifulSoup(home_page,</span><span style="color:#9ECBFF;">&#39;lxml&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        script </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> soup.find(</span><span style="color:#FFAB70;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;getAreaStat&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        json_str </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> re.findall(</span><span style="color:#F97583;">r</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#85E89D;font-weight:bold;">\\[</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">+</span><span style="color:#85E89D;font-weight:bold;">\\]</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">(script))[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> json.loads(json_str)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.save(data,</span><span style="color:#9ECBFF;">&#39;last_corona_virus_of_china.json&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">crawl_corona_virus_of_china</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">        last_day_corona_virus_of_china </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.load(</span><span style="color:#9ECBFF;">&#39;last_day_corona_virus_of_china.json&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        corona_virus </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.parse_corona_virus(last_day_corona_virus_of_china,</span><span style="color:#9ECBFF;">&#39;采集1月25日以来国内各省的疫情数据&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.save(corona_virus,</span><span style="color:#9ECBFF;">&#39;corona_virus_of_china.json&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#类CoronaVirusSpider的开始部分</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.crawl_corona_virus()  </span><span style="color:#6A737D;">#爬取最近一日全球的疫情数据</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.crawl_corona_virus_of_china()   </span><span style="color:#6A737D;">#爬取最近一日全国的疫情数据</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># self.crawl_last_corona_virus_of_china()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__name__</span><span style="color:#F97583;">==</span><span style="color:#9ECBFF;">&#39;__main__&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">   spider </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> CoronaVirusSpider()</span></span>
<span class="line"><span style="color:#E1E4E8;">   spider.run()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> requests</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> re</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> json</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> bs4 </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> BeautifulSoup</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> tqdm </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> tqdm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CoronaVirusSpider</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">object</span><span style="color:#24292E;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#load、save、get_content_from_url、parse_corona_virus是工具函数，都会用到，所以都放到上边</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__init__</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.home_url </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;https://ncov.dxy.cn/ncovh5/view/pneumonia&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(self,path):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(path,</span><span style="color:#E36209;">encoding</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;utf-8&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> fp:</span></span>
<span class="line"><span style="color:#24292E;">            data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> json.load(fp)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">(self,data,path):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(path,</span><span style="color:#032F62;">&#39;w&#39;</span><span style="color:#24292E;">,</span><span style="color:#E36209;">encoding</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;utf-8&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> fp:</span></span>
<span class="line"><span style="color:#24292E;">            json.dump(data,fp,</span><span style="color:#E36209;">ensure_ascii</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">get_content_from_url</span><span style="color:#24292E;">(self,url):</span></span>
<span class="line"><span style="color:#24292E;">        response </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> requests.get(url)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> response.content.decode()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parse_corona_virus</span><span style="color:#24292E;">(self,last_day_corona_virus_of_china,desc):</span></span>
<span class="line"><span style="color:#24292E;">        corona_virus </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> country </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> tqdm(last_day_corona_virus_of_china,desc):</span></span>
<span class="line"><span style="color:#24292E;">            statistics_data_url </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> country[</span><span style="color:#032F62;">&#39;statisticsData&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">            statistics_data_json_str </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.get_content_from_url(statistics_data_url)</span></span>
<span class="line"><span style="color:#24292E;">            statistics_data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> json.loads(statistics_data_json_str)[</span><span style="color:#032F62;">&#39;data&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> one_day </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> statistics_data:</span></span>
<span class="line"><span style="color:#24292E;">                one_day[</span><span style="color:#032F62;">&#39;provinceName&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> country[</span><span style="color:#032F62;">&#39;provinceName&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> country.get(</span><span style="color:#032F62;">&#39;countryShortCode&#39;</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">                    one_day[</span><span style="color:#032F62;">&#39;countryShortCode&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> country[</span><span style="color:#032F62;">&#39;countryShortCode&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">            corona_virus.extend(statistics_data)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> corona_virus</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#parse_home_page、crawl_last_day_corona_virus这两个函数是提取爬取好全国数据，之后放到文件中提供给</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#crawl_corona_virus、parse_corona_virus函数用于读取和解析全球疫情数据</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parse_home_page</span><span style="color:#24292E;">(self,home_page,tag_id):</span></span>
<span class="line"><span style="color:#24292E;">        soup </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> BeautifulSoup(home_page,</span><span style="color:#032F62;">&#39;lxml&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        script </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> soup.find(</span><span style="color:#E36209;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tag_id)</span></span>
<span class="line"><span style="color:#24292E;">        json_str </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> re.findall(</span><span style="color:#D73A49;">r</span><span style="color:#032F62;">&#39;</span><span style="color:#22863A;font-weight:bold;">\\[</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">+</span><span style="color:#22863A;font-weight:bold;">\\]</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">(script))[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> json.loads(json_str)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">crawl_last_day_corona_virus</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">        home_page </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.get_content_from_url(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.home_url)</span></span>
<span class="line"><span style="color:#24292E;">        last_day_corona_virus </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.parse_home_page(home_page,</span><span style="color:#E36209;">tag_id</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;getListByCountryTypeService2true&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.save(last_day_corona_virus,</span><span style="color:#032F62;">&#39;last_day_corona_virus.json&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">crawl_corona_virus</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">        last_day_corona_virus </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.load(</span><span style="color:#032F62;">&#39;last_day_corona_virus.json&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        corona_virus </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.parse_corona_virus(last_day_corona_virus,</span><span style="color:#E36209;">desc</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;采集1月25以来各国疫情数据&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.save(corona_virus,</span><span style="color:#032F62;">&#39;corona_virus.json&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#crawl_last_corona_virus_of_china提前爬取好全国数据，</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#供crawl_corona_virus_of_china、parse_corona_virus函数读取和解析使用</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">crawl_last_corona_virus_of_china</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">        home_page </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.get_content_from_url(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.home_url)</span></span>
<span class="line"><span style="color:#24292E;">        soup </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> BeautifulSoup(home_page,</span><span style="color:#032F62;">&#39;lxml&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        script </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> soup.find(</span><span style="color:#E36209;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;getAreaStat&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        json_str </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> re.findall(</span><span style="color:#D73A49;">r</span><span style="color:#032F62;">&#39;</span><span style="color:#22863A;font-weight:bold;">\\[</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">+</span><span style="color:#22863A;font-weight:bold;">\\]</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">(script))[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> json.loads(json_str)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.save(data,</span><span style="color:#032F62;">&#39;last_corona_virus_of_china.json&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">crawl_corona_virus_of_china</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">        last_day_corona_virus_of_china </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.load(</span><span style="color:#032F62;">&#39;last_day_corona_virus_of_china.json&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        corona_virus </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.parse_corona_virus(last_day_corona_virus_of_china,</span><span style="color:#032F62;">&#39;采集1月25日以来国内各省的疫情数据&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.save(corona_virus,</span><span style="color:#032F62;">&#39;corona_virus_of_china.json&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#类CoronaVirusSpider的开始部分</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.crawl_corona_virus()  </span><span style="color:#6A737D;">#爬取最近一日全球的疫情数据</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.crawl_corona_virus_of_china()   </span><span style="color:#6A737D;">#爬取最近一日全国的疫情数据</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># self.crawl_last_corona_virus_of_china()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__name__</span><span style="color:#D73A49;">==</span><span style="color:#032F62;">&#39;__main__&#39;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">   spider </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CoronaVirusSpider()</span></span>
<span class="line"><span style="color:#24292E;">   spider.run()</span></span></code></pre></div>`,7),e=[o];function r(c,t,E,y,i,_){return a(),n("div",null,e)}const d=s(p,[["render",r]]);export{u as __pageData,d as default};
